(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{mn:()=>G,p8:()=>W,xm:()=>F,VI:()=>J,ql:()=>K});const e=document.querySelector(".boards"),n=document.querySelector(".currentPlayer"),r=document.getElementById("current"),i=document.getElementById("opponent"),s=document.getElementById("placeScreen"),o=document.getElementById("placement"),a=document.getElementById("switchDir"),d=document.querySelector(".playerSwitch"),l=d.querySelector("button"),c=document.querySelector("form.startMenu"),h=c.querySelectorAll(".mode input"),u=c.querySelector(".difficulty"),f=c.querySelector("button"),m=document.querySelector(".gameover"),p=document.getElementById("winner"),y=m.querySelector("button.restart"),b=m.querySelector("button.exit");function v(t){r.textContent="";for(let e in t)for(let n in t[e]){const i=t[e][n],s=k(e,n,x(i));s.dataset.ship=i.ship.name,r.appendChild(s)}}function g(t){i.textContent="";for(let e in t)for(let n in t[e]){const r=t[e][n],s=k(e,n,x(r));s.addEventListener("click",(()=>{q(e,n)})),i.appendChild(s)}}function L(t,e){o.textContent="";const n=e.shift();for(let r in t)for(let i in t[r]){const s=t[r][i];let a=k(r,i);if(s.ship&&(a.dataset.ship=s.ship.name),!n)return void F();o.appendChild(a),a.addEventListener("mouseover",(()=>{const t="true"===o.dataset.vertical;S(r,i,n.length,t,!0)})),a.addEventListener("mouseout",(()=>{const t="true"===o.dataset.vertical;S(r,i,n.length,t,!1)})),a.addEventListener("click",(()=>{const s="true"===o.dataset.vertical;G(+r,+i,n.id,s)&&L(t,e)}))}}function S(t,e,n,r,i){for(let s=0;s<n;s++){let n;n=r?`[data-x="${+t+1*s}"][data-y="${e}"]`:`[data-x="${t}"][data-y="${+e+1*s}"]`;try{const t=o.querySelector(n);i?t.classList.add("highlight"):t.classList.remove("highlight")}catch(t){console.error("Cell is out of bounds.")}}}function x(t){const e=t.hit,n=!!t.ship;return null===e?"unhit":e&&n?"hit":"miss"}function k(t,e,n="unhit"){const r=document.createElement("div");return r.classList.add("cell"),r.dataset.x=t,r.dataset.y=e,r.dataset.status=n,r}function q(t,e){if(!W(t,e))return;const n=function(t,e){return i.querySelector(`.cell[data-x='${t}'][data-y='${e}']`)}(t,e);n.dataset.status="hit"}function C(t){n.textContent=t}function E(t=!1){t?i.classList.add("disabled"):i.classList.remove("disabled")}function I(t,e,n){if(t)return void d.classList.add("hidden");const r=d.querySelector(".currentPlayer"),i=d.querySelector(".otherPlayer");r.textContent=e,i.textContent=n,d.classList.remove("hidden")}h.forEach((t=>{t.addEventListener("click",(()=>{"player"===t.value?u.classList.add("hidden"):u.classList.remove("hidden")}))})),y.addEventListener("click",(()=>{e.classList.remove("hidden"),r.classList.add("hidden"),i.classList.add("hidden"),s.classList.remove("hidden"),m.classList.add("hidden"),K()})),b.addEventListener("click",(()=>{m.classList.add("hidden"),c.classList.remove("hidden"),n.classList.add("hidden"),e.classList.add("hidden"),r.textContent="",i.textContent=""})),f.addEventListener("click",(()=>{const t=c.querySelector(".mode input:checked").value,e=c.querySelector(".difficulty input:checked").value;c.classList.add("hidden"),J(t,e)})),a.addEventListener("click",(()=>{const t=o.dataset.vertical;o.dataset.vertical="true"===t?"false":"true"})),l.addEventListener("click",(()=>{d.classList.add("hidden")}));const w=class{constructor(t,e){this.length=e,this.name=t,this.hits=0}get hasSunk(){return this.hits>=this.length}hit(){return!this.hasSunk&&(this.hits++,!0)}},B=class{constructor(){this.board=this.#t()}shipTypes=new Map([[0,{length:5,name:"Carrier"}],[1,{length:4,name:"Battleship"}],[2,{length:3,name:"Cruiser"}],[3,{length:4,name:"Submarine"}],[4,{length:2,name:"Destroyer"}]]);get hasShips(){for(let t in this.board)for(let e in this.board[t])if(!1!==this.board[t][e].ship)return!0;return!1}get allShipsDestroyed(){for(let t in this.board)for(let e in this.board[t]){const n=this.board[t][e].ship,r=this.board[t][e].hit;if(!1!==n&&!r)return!1}return!0}addShip(t,e,n,r){const i=this.shipTypes.get(n);if(!i)return!1;const s=i.length,o=i.name;if(!this.#e(t,e,s,r))return!1;const a=new w(o,s);for(let n=0;n<s;n++)r?this.board[t+n][e].ship=a:this.board[t][e+n].ship=a;return!0}#e(t,e,n,r){const i=this.board.length-1;if(r){if(t+n-1>i)return!1}else if(e+n-1>i)return!1;for(let i=0;i<n;i++)if(r){if(this.board[t+i][e].ship)return!1}else if(this.board[t][e+i].ship)return!1;return!0}attack(t,e){const n=this.board[t][e];return null!==n.hit?null:(this.board[t][e].hit=!0,!!n.ship&&(n.ship.hit(),!0))}clearShips(){const t=this.board.length,e=this.board[0].length;for(let n=0;n<t;n++)for(let t=0;t<e;t++)this.board[n][t].ship=!1,this.board[n][t].hit=null}#t(t=10){const e=[];for(let n=0;n<t;n++){const n=[];for(let e=0;e<t;e++)n.push({ship:!1,hit:null});e.push(n)}return e}getBoard(){return this.board}unhitAllCells(){for(let t in this.board)for(let e in this.board[t])this.board[t][e].hit=null}randomizeBoard(){for(const[t,e]of this.shipTypes){const e=this.board.length;let n=this.#n(e),r=this.#n(e),i=this.#n(2);for(;!this.addShip(n,r,t,i);)n=this.#n(e),r=this.#n(e),i=this.#n(2)}}#n(t){return Math.floor(Math.random()*t)}};function P(t){const e=t.board.board,n=e.length;let r,i;do{r=$(n),i=$(n)}while(e[r][i].hit);return{x:r,y:i}}function $(t){return Math.floor(Math.random()*t)}class M{constructor(){this.type="player",this.board=new B}}class R extends M{constructor(t){super(),this.type="computer",this.difficulty=t}attack(t){return function(t,e){return"random"===e?P(t):function(t){const e=t.board.board,n=e.length;for(let t=0;t<n;t++)for(let r=0;r<n;r++){const i=e[r][t],s=i.hit,o=i.ship;if(!s||!o)continue;let a,d;if(a=r-1,a>=0&&null===e[a][t].hit)return{x:a,y:t};if(a=r+1,a<n&&null===e[a][t].hit)return{x:a,y:t};if(d=t-1,d>=0&&null===e[r][d].hit)return{x:r,y:d};if(d=t+1,d<n&&null===e[r][d].hit)return{x:r,y:d}}return P(t)}(t)}(t,this.difficulty)}}let D,T,A,O=0,j="player",z="random";function F(){return"computer"===j?(T.board.randomizeBoard(),void N()):1===O?(I(!1,O+1,U()+1),O=U(),void N()):(I(!1,O+1,U()+1),O=U(),C(`Player ${O+1}`),void V())}function V(){const t=A[O].board.shipTypes,o=[];for(let e of Array.from(t.keys())){const{length:n,name:r}=t.get(e);o.push({id:e,length:n,name:r})}L(A[O].board.board,o),n.classList.remove("hidden"),e.classList.remove("hidden"),r.classList.add("hidden"),i.classList.add("hidden"),s.classList.remove("hidden")}function G(t,e,n,r){return A[O].board.addShip(t,e,n,r)}function H(){C(`Player ${O+1}`),v(A[O].board.board),g(A[U()].board.board)}function J(t,e){D=new M,T=new R(e),A=[D,T],j=t,z=e,V()}function K(){O=0,D.board.clearShips(),T.board.clearShips(),V()}function N(){O=0,H(),E(!1),n.classList.remove("hidden"),e.classList.remove("hidden"),r.classList.remove("hidden"),i.classList.remove("hidden"),s.classList.add("hidden")}function Q(t){var e;E(!0),e=t,E(!0),m.classList.remove("hidden"),p.textContent=e}function U(){return 0===O?1:0}function W(t,e){const n=A[O],r=A[U()],i=r.board.attack(t,e);return i?r.board.allShipsDestroyed&&(I(!0),Q(`Player ${O+1}`)):!1===i&&(H(),"computer"===j?(C("Computer"),async function(t,e){let n=!0;for(E(!0);n;){await X((r=500,i=1100,Math.floor(Math.random()*(i-r+1)+r)));let{x:s,y:o}=t.attack(e);if(n=e.board.attack(s,o),H(),e.board.allShipsDestroyed)return void Q("Computer")}var r,i;E(!1)}(r,n)):(I(!1,O+1,U()+1),O=U(),C(`Player ${O+1}`),v(A[O].board.board),g(A[U()].board.board))),i}const X=t=>new Promise((e=>setTimeout(e,t)))})();